# docker-compose.dev.yml
# Development environment - backend & frontend with hot reload
# External services: PostgreSQL, Redis, S3 (configured in .env)
# Usage: docker compose -f docker-compose.base.yml -f docker-compose.dev.yml up -d

services:
  #################
  # Backend (FastAPI) - DEV (hot reload)
  #################
  backend:
    container_name: ugm_aicare_backend_dev
    image: ugm-aicare-backend-dev
    command: >
      bash -c "
        echo 'ðŸš€ Starting backend (DEV, reload disabled in Docker)...' &&
        uvicorn app.main:app --host 0.0.0.0 --port ${PORT:-22001} --log-level info
      "
    ports:
      - "${BACKEND_EXTERNAL_PORT:-22001}:22001"
    deploy:
      resources:
        limits:
          memory: 4G
        reservations:
          memory: 2G
    environment:
      PORT: 22001
      ADMIN_EMAIL: ${ADMIN_EMAIL}
      ADMIN_PASSWORD: ${ADMIN_PASSWORD}
      COUNSELOR_EMAIL: ${COUNSELOR_EMAIL}
      COUNSELOR_PASSWORD: ${COUNSELOR_PASSWORD}
      COUNSELOR_NAME: ${COUNSELOR_NAME:-Main Counselor}
      FRONTEND_URL: ${FRONTEND_URL}
      BACKEND_URL: ${BACKEND_URL}
      ALLOWED_ORIGINS: "https://aicare.ina17.com,http://localhost:22000,http://127.0.0.1:22000,http://localhost:22001,http://127.0.0.1:22001,http://frontend:22000,http://backend:22001"
      APP_ENV: development
      LANGFUSE_ENABLED: "false"
      LANGFUSE_HOST: "http://langfuse-server:3000"
    restart: unless-stopped
    networks:
      - internal_network_dev
    dns: 8.8.8.8

  #################
  # Frontend (Next.js) - DEV (hot reload)
  #################
  frontend:
    container_name: ugm_aicare_frontend_dev
    image: ugm-aicare-frontend-dev
    build:
      target: development
    ports:
      - "${FRONTEND_EXTERNAL_PORT:-22000}:22000"
    deploy:
      resources:
        limits:
          memory: 4G
        reservations:
          memory: 2G
    environment:
      NODE_ENV: development
      PORT: 22000
      GOOGLE_CLIENT_ID: ${GOOGLE_CLIENT_ID}
      GOOGLE_CLIENT_SECRET: ${GOOGLE_CLIENT_SECRET}
    volumes:
      - ./frontend:/app
      - frontend_node_modules:/app/node_modules
      - frontend_next_cache:/app/.next
      - frontend_turbo_cache:/app/.turbo
    restart: unless-stopped
    networks:
      - internal_network_dev

volumes:
  frontend_node_modules: {}
  frontend_next_cache: {}
  frontend_turbo_cache: {}

networks:
  internal_network_dev:
    driver: bridge

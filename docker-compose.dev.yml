# docker-compose.dev.yml
# Development environment - backend & frontend with hot reload
# External services: PostgreSQL, Redis, S3 (configured in .env)
# Usage: docker compose -f docker-compose.base.yml -f docker-compose.dev.yml up -d

services:
  #################
  # Backend (FastAPI) - DEV (hot reload)
  #################
  backend:
    container_name: ugm_aicare_backend_dev
    command: >
      bash -c "
        echo 'ðŸš€ Starting backend with hot reload...' &&
        uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload --reload-dir /app/app --log-level info
      "
    ports:
      - "${BACKEND_EXTERNAL_PORT:-22001}:8000"
    deploy:
      resources:
        limits:
          memory: 2G
        reservations:
          memory: 1G
    environment:
      ADMIN_EMAIL: ${ADMIN_EMAIL}
      ADMIN_PASSWORD: ${ADMIN_PASSWORD}
      COUNSELOR_EMAIL: ${COUNSELOR_EMAIL}
      COUNSELOR_PASSWORD: ${COUNSELOR_PASSWORD}
      COUNSELOR_NAME: ${COUNSELOR_NAME:-Main Counselor}
      FRONTEND_URL: ${FRONTEND_URL}
      BACKEND_URL: ${BACKEND_URL}
      ALLOWED_ORIGINS: "https://aicare.ina17.com,http://localhost:22000,http://127.0.0.1:22000,http://localhost:3000,http://127.0.0.1:3000,http://frontend:3000,http://backend:8000"
      APP_ENV: development
      LANGFUSE_ENABLED: "false"
      LANGFUSE_HOST: "http://langfuse-server:3000"
    volumes:
      - ./backend:/app
      - /app/.venv
      - /app/__pycache__
    restart: unless-stopped
    networks:
      - internal_network_dev
    dns: 8.8.8.8

  #################
  # Frontend (Next.js) - DEV (hot reload)
  #################
  frontend:
    container_name: ugm_aicare_frontend_dev
    build:
      target: development
    ports:
      - "${FRONTEND_EXTERNAL_PORT:-22000}:3000"
    deploy:
      resources:
        limits:
          memory: 4G
        reservations:
          memory: 2G
    environment:
      NODE_ENV: development
      GOOGLE_CLIENT_ID: ${GOOGLE_CLIENT_ID}
      GOOGLE_CLIENT_SECRET: ${GOOGLE_CLIENT_SECRET}
    volumes:
      - ./frontend:/app
      - /app/node_modules
    restart: unless-stopped
    networks:
      - internal_network_dev

volumes: {}

networks:
  internal_network_dev:
    driver: bridge
